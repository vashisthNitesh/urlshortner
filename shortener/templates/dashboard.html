{% extends "base.html" %}

{% block title %}Dashboard | genieURL{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2>Your dashboard</h2>
      <p class="text-muted">Plan: {{ plan }}</p>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{% url 'api_keys' %}">API keys</a>
      <a class="btn btn-outline-secondary" href="{% url 'custom_domains' %}">Custom domains</a>
      <a class="btn btn-outline-primary" href="{% url 'billing' %}">Billing</a>
    </div>
  </div>

  {% if ad_enabled %}
    <div class="ad-slot mb-4">Ad slot (Google AdSense / partner)</div>
  {% endif %}

  <div class="row g-4">
    <div class="col-lg-5">
      <div class="card p-4">
        <h4>Create a new short link</h4>
        <form method="post">
          {% csrf_token %}
          {{ form.as_p }}
          <button class="btn btn-primary" type="submit">Shorten</button>
        </form>
      </div>
    </div>
    <div class="col-lg-7">
      <div class="card p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">Your links</h4>
          <form method="get" class="d-flex gap-2">
            <input class="form-control form-control-sm" type="search" name="q" placeholder="Search" />
            <button class="btn btn-outline-secondary btn-sm" type="submit">Filter</button>
          </form>
        </div>
        {% if links %}
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Slug</th>
                  <th>Destination</th>
                  <th>Clicks</th>
                  <th>QR</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for link in links %}
                  <tr>
                    <td><a href="{% url 'link_detail' link.slug %}">{{ link.slug }}</a></td>
                    <td class="text-truncate" style="max-width: 200px;">{{ link.destination_url }}</td>
                    <td>{{ link.clicks.count }}</td>
                    <td>
                      {% if link.qr_code_image %}
                        <a href="{{ link.qr_code_image.url }}" download>Download</a>
                      {% else %}
                        â€”
                      {% endif %}
                    </td>
                    <td class="text-end">
                      <a class="btn btn-sm btn-outline-primary" href="{% url 'link_edit' link.slug %}">Edit</a>
                      <form method="post" action="{% url 'link_delete' link.slug %}" class="d-inline">
                        {% csrf_token %}
                        <button class="btn btn-sm btn-outline-danger" type="submit">Disable</button>
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted">No links yet. Create your first short URL.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
